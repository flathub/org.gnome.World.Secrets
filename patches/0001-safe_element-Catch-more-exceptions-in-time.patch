From 59b1149252f931d44b92ea12b6fbae18232e11f4 Mon Sep 17 00:00:00 2001
From: Maximiliano Sandoval <msandova@gnome.org>
Date: Thu, 21 Mar 2024 18:38:53 +0100
Subject: [PATCH 1/3] safe_element: Catch more exceptions in time

Fixes: https://gitlab.gnome.org/World/secrets/-/issues/525
---
 gsecrets/safe_element.py | 15 ++++++++++++---
 1 file changed, 12 insertions(+), 3 deletions(-)

diff --git a/gsecrets/safe_element.py b/gsecrets/safe_element.py
index 8bf1cc4b..107f7cc2 100644
--- a/gsecrets/safe_element.py
+++ b/gsecrets/safe_element.py
@@ -327,8 +327,11 @@ class SafeElement(GObject.Object):
         """The UTC accessed time of the element."""
         try:
             time = self._element.atime
+        except ValueError as err:
+            logging.error("Invalid accessed time: %s", str(err))
+            return None
         except OverflowError:
-            logging.error("Accessed time for %s is invalid", self.name)
+            logging.error("Accessed time for %s overflows", self.name)
             return None
 
         if not time:
@@ -344,8 +347,11 @@ class SafeElement(GObject.Object):
         """The UTC creation time of the element."""
         try:
             time = self._element.ctime
+        except ValueError as err:
+            logging.error("Invalid creation time: %s", str(err))
+            return None
         except OverflowError:
-            logging.error("Creation time for %s is invalid", self.name)
+            logging.error("Creation time for %s overflows", self.name)
             return None
 
         if not time:
@@ -361,8 +367,11 @@ class SafeElement(GObject.Object):
         """The UTC modified time of the element."""
         try:
             time = self._element.mtime
+        except ValueError as err:
+            logging.error("Invalid modified time: %s", str(err))
+            return None
         except OverflowError:
-            logging.error("Modified time for %s is invalid", self.name)
+            logging.error("Modified time for %s overflows", self.name)
             return None
 
         if not time:
-- 
2.44.0

